{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Новый документ</title>
    <meta content="" name="description">
    <meta content="" name="keywords">


    <!-- Google Fonts -->
    <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/icofont/icofont.min.css' %}" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="{% static 'makereport/css/main.css' %}" rel="stylesheet">
    <link href="{% static 'makereport/css/desktop7.css' %}" rel="stylesheet">


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          crossorigin="anonymous">
    <link href="{% static '/path/to/css/fileinput.css' %}" media="all" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
    <link href="{% static '/path/to/themes/explorer-fas/theme.css' %}" media="all" rel="stylesheet" type="text/css">
    <script src="{% static '/path/to/jquery-3.3.1.min.js' %}"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
    <script src="{% static '/path/to/js/plugins/piexif.js' %}" type="text/javascript"></script>
    <script src="{% static '/path/to/js/plugins/sortable.js' %}" type="text/javascript"></script>
    <script src="{% static '/path/to/js/fileinput.js' %}" type="text/javascript"></script>
    <script src="{% static '/path/to/themes/fas/theme.js' %}" type="text/javascript"></script>

    <script src="https://unpkg.com/ionicons@5.2.3/dist/ionicons.js"></script>
    <!-- Vendor JS Files -->
    {#	<script src="{% static '/makereport/vendor/jquery/jquery.min.js' %}"></script>#}
    {#	<!-- Template Main JS File -->#}
    {#	<script src="{% static '/makereport/js/jquery-1.12.4.js' %}"></script>#}
    <script src="{% static '/makereport/js/script.min.js' %}"></script>
    <script src="{% static '/makereport/js/main.js' %}"></script>
    <script src="{% static '/makereport/js/e-imzo.js' %}" type="text/javascript"></script>
    <script src="{% static '/makereport/js/e-imzo-client.js' %}" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/makereport/css/modal.css' %}"/>
</head>

<!-- =======================================================
  * Template Name: 
  * Template URL: 
  * Author:
  * License: 
  ======================================================== -->

<body>

<!-- ======= Mobile nav toggle button ======= -->
<button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

<!-- ======= Header ======= -->
 {% include 'makereport/header/left_navbar.html' with new_page="active"  %}


<main id="main">


    <!-- ======= Header ======= -->
    <div class="header-top">
        <div class="container">

            <nav class="new-document-part">
                <ul>
                    <li><a href="{% url 'new_report' %}" class="new-document-btn">Новый документ</a></li>
                </ul>
            </nav>

            <nav class="user-profile-part">
                <ul>
                    <li class="img-user-profile"><img src="{% static '/makereport/img/user.png' %}"></li>
                    <li class="user-name-btn"><a href="#">{{ user.username }}</a></li>
                    <li><a href="{% url 'user_logout' %}" class="log-out-btn">Выйти</a></li>
                </ul>
            </nav>

        </div>
    </div>
    <!-- ======= Header ======= -->
    {% if car_form.errors.brand %}
        <div class="alert alert-danger">
            <strong>
                {{ car_form.errors.brand }}
            </strong>
        </div>

    {% endif %}



    <section class="padding_phone" style="z-index: 9999 !important;">

        <form method="POST" class="material-form-2" enctype="multipart/form-data">{% csrf_token %}
            <input type="number" value="{{ id_image }}" id="id_image" name="id_image" style="display: none"/>
            <input type="number" value="{{ id }}" name="id_report" style="display: none"/>
            <div class="accordion one">
                <!-- 1 -->
                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-title">Данные</span>
                        <img src="{% static '/makereport/img/Polygon.png' %}" alt="polygon" class="polygon">
                    </div>
                    <div class="inside-content accordion-content">
                        <div class="accordion-content-wrapper">
                            <div class="inputs_big">
                                <div class="left-inputs">

                                    {#                                            <input type="text" placeholder="Отчёт" class="input_in">#}
                                    {{ report_form.report_number }}
                                    {{ report_form.report_date }}
                                    {{ contract_form.contract_number }}
                                    {{ contract_form.contract_date }}
                                    {% if car_form.errors.car_number %}
                                        <div class="alert alert-danger">
                                            <strong>
                                                {{ car_form.errors.car_number }}
                                            </strong>
                                        </div>
                                    {% endif %}
                                    {{ car_form.car_number }}
                                    {% comment %} {% endcomment %}
                                    {{ car_form.brand_text }}
                                    {{ car_form.registration }}
                                    {{ car_form.engine_number }}
                                    {{ car_form.body_number }}
                                    {{ car_form.chassis }}
                                    {{ car_form.car_color }}
                                    {{ car_form.mileage }}
                                    {% if car_form.errors.release_date %}
                                        <div class="alert alert-danger">
                                            <strong>
                                                Введите правильный год
                                            </strong>
                                        </div>
                                    {% endif %}
                                    {{ car_form.release_date }}
                                    {% if car_form.errors.type_of_car %}
                                        <div class="alert alert-danger">
                                            <strong>
                                                Выберите тип машины
                                            </strong>
                                        </div>
                                    {% endif %}
                                    {{ car_form.type_of_car }}

                                </div>
                                <div class="divider"></div>
                                <div class="right-inputs">
                                    {{ car_form.car_owner }}
                                    {{ car_form.owner_address }}
                                    {{ customer_form.name }}
                                    {{ customer_form.address }}
                                    {% if customer_form.errors.passport_number %}
                                        <div class="alert alert-danger">
                                            <strong>
                                                {{ customer_form.errors.passport_number }}
                                            </strong>
                                        </div>
                                    {% endif %}
                                    {{ customer_form.passport_number }}
                                    {% if customer_form.errors.when_passport_issued %}
                                        <div class="alert alert-danger">
                                            <strong>
                                                {{ customer_form.errors.when_passport_issued }}
                                            </strong>
                                        </div>
                                    {% endif %}
                                    {{ customer_form.when_passport_issued }}
                                    {{ customer_form.whom_passport_issued }}
                                    {{ customer_form.phone_number }}
                                    {{ customer_form.gnu_or_gje }}
                                    {{ customer_form.uvajaemaya }}
                                    {{ customer_form.mesto_osmotra }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 1 -->
                <div class="row">

                    <div class="col-lg-4">


                        {{ car_form.brand }}

                    </div>
                    <div class="col-lg-4">
                        <div class="select-block">
                            <label>Надбавка</label>
                            <div class="custom-select">
                                <div class="active-list"> 0</div>
                                <input type="text" id="procent" class="list-field" value="0"/>
                                <ul class="drop-down-list">
                                    <li>10 %</li>
                                    <li>20 %</li>
                                    <li>Отменить</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="select-block">
                            <label>Сумма</label>
                            <div class="custom-select">
                                <div id="" class="active-list">0</div>
                                <input type="text" id="price_all_services" class="list-field" value="0"/>
                                <ul class="drop-down-list">
                                    {% for price in prices %}
                                        <li>{{ price.sum }}</li>
                                    {% endfor %}
                                    {#                                    <li>40 %</li>#}
                                    {#                                    <li>50 %</li>#}
                                    {#                                    <li>60 %</li>#}
                                    {#                                    <li>70 %</li>#}
                                    {#                                    <li>80 %</li>#}
                                    {#                                    <li>90 %</li>#}
                                    {#                                    <li>100 %</li>#}
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- 2 -->
                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-title">Стоимость работы</span>
                        <img src="{% static '/makereport/img/Polygon.png' %}" alt="polygon" class="polygon">
                    </div>
                    <div class="inside-content accordion-content" style="display: none;">
                        <div class="accordion-content-wrapper">
                            <div class="div" id="service_formset">
                                <table style="width: 100%;">
                                    {#                                        <tbody>#}
                                    <tr>
                                        <th class="table-headers">№</th>
                                        <th class="table-headers">ID</th>
                                        <th class="table-headers">Наименование</th>
                                        <th class="table-headers">Нор/час</th>
                                        <th class="table-headers">Надбавка</th>
                                        <th class="table-headers">Цена</th>
                                        <th class="table-headers">Сумма</th>
                                    </tr>
                                    {{ service_formset.management_form }}
                                    {% for form in service_formset.forms %}
                                        <table class="no_error">
                                            <tr>
                                                <td>{{ forloop.counter }}</td>
                                                <td>{{ form.service_id }}</td>
                                                <td>{{ form.name }}</td>
                                                <td>{{ form.norm_per_hour }}</td>
                                                <td>{{ form.premium }}</td>
                                                <td>{{ form.price }}</td>
                                                <td>{{ form.service_cost }}</td>
                                            </tr>
                                        </table>
                                    {% endfor %}
                                    <div id="empty_service_form" style="display:none">
                                        <table class='no_error'>
                                            <tr>
                                                <td class="index">replace_counter</td>
                                                <td>{{ service_formset.empty_form.service_id }}</td>
                                                <td>{{ service_formset.empty_form.name }}</td>
                                                <td>{{ service_formset.empty_form.norm_per_hour }}</td>
                                                <td>{{ service_formset.empty_form.premium }}</td>
                                                <td>{{ service_formset.empty_form.price }}</td>
                                                <td>{{ service_formset.empty_form.service_cost }}</td>
                                            </tr>
                                        </table>
                                    </div>
                                    {#                                        </tbody>#}
                                </table>
                            </div>
                            <div>
                                <ul class="responsive-table">
                                    <li class="table-row">
                                        <div class="col col-1" data-label="">Общая<span>стоимость</span></div>
                                        <div class="col col-2" data-label="Эксплуатационныйизнос"><span
                                                id="all_service_cost" class="divide-integer-label">{{ report.service_cost }}</span></div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 2 -->

                <!-- 3 -->
                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-title">Запчасти</span>
                        <img src="{% static '/makereport/img/Polygon.png' %}" alt="polygon" class="polygon">
                    </div>
                    <div class="inside-content accordion-content" style="display: none;">
                        <div class="accordion-content-wrapper">
                            <div class="div" id="product_formset">
                                <table>
                                    {#                                        <tbody>#}
                                    <tr>
                                        <th class="table-spare-part-headers" style="width: 20px;text-align: left">№</th>
                                        <th class="table-spare-part-headers">Наименование</th>
                                        <th class="table-spare-part-headers">Кол-во</th>
                                        <th class="table-spare-part-headers">Цена</th>
                                        <th class="table-spare-part-headers">Сумма</th>
                                    </tr>
                                    {{ product_formset.management_form }}
                                    {% for form in product_formset.forms %}
                                        {#                                        {{ form.non_field_errors }}#}
                                        {#                                        {{ form.errors }}#}
                                        <table class='no_error'>
                                            <tr>
                                                <td id="counter_id">{{ forloop.counter }}</td>
                                                <td>{{ form.name }}</td>
                                                {#                                                <td>{{ form.unit }}</td>#}
                                                <td>{{ form.quantity }}</td>
                                                <td>{{ form.price }}</td>
                                                <td>{{ form.product_cost }}</td>
                                            </tr>
                                        </table>
                                    {% endfor %}
                                    <div id="empty_product_form" style="display:none">
                                        <table class='no_error'>
                                            <tr>
                                                <td id="counter_id" class="index">replace_counter</td>
                                                <td>{{ product_formset.empty_form.name }}</td>
                                                {#                                                        <td>{{ product_formset.empty_form.unit }}</td>#}
                                                <td>{{ product_formset.empty_form.quantity }}</td>
                                                <td>{{ product_formset.empty_form.price }}</td>
                                                <td>{{ product_formset.empty_form.product_cost }}</td>
                                            </tr>
                                        </table>
                                    </div>
                                    {#                                        </tbody>#}
                                </table>

                            </div>
                            <div>
                                <ul class="responsive-table">
                                    <li class="table-row">
                                        <div class="col col-1" data-label="">Общая<span>стоимость</span></div>
                                        <div class="col col-2" data-label="Эксплуатационныйизнос"><span
                                                id="all_product_cost" class="divide-integer-label">{{ report.product_cost }}</span></div>
                                    </li>
                                    <li class="table-row">
                                        <div class="col col-1" data-label="">Износ<span>Ки</span></div>
                                        <div class="col col-2" data-label="Эксплуатационныйизнос"><span
                                                id="product_wear_show" class="">{{ report.wear_data.accept_wear }}</span></div>
                                    </li>
                                    <li class="table-row">
                                        <div class="col col-1" data-label="">
                                            Общая<span>стоимость</span><span>c</span><span>учетом</span><span>износа</span>
                                        </div>
                                        <div class="col col-2" data-label="Эксплуатационныйизнос"><span
                                                id="product_overall_cost" class="">0</span></div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 3 -->

                <!-- 4 -->
                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-title">Материалы</span>
                        <img src="{% static '/makereport/img/Polygon.png' %}" alt="polygon" class="polygon">
                    </div>
                    <div class="inside-content accordion-content" style="display: none;">
                        <div class="accordion-content-wrapper">
                            <div class="div" id="consumable_formset">
                                <table>
                                    <tbody>
                                    <tr>
                                        <th class="table-spare-part-headers4" style="text-align: left">№</th>
                                        <th class="table-spare-part-headers4">ID</th>
                                        <th class="table-spare-part-headers4">Наименование</th>
                                        <th class="table-spare-part-headers4">Ед.изм.</th>
                                        <th class="table-spare-part-headers4">Кол-во</th>
                                        <th class="table-spare-part-headers4">Ед.расхода</th>
                                        <th class="table-spare-part-headers4">Сумма</th>
                                    </tr>
                                    {{ consumable_formset.management_form }}
                                    {% for form in consumable_formset.forms %}
                                        {#                                        {{ form.non_field_errors }}#}
                                        {#                                        {{ form.errors }}#}
                                        <table class='no_error'>
                                            <tr>
                                                <td class="id_padding">{{ forloop.counter }}</td>
                                                <td>{{ form.consumable_id }}</td>
                                                <td>{{ form.name }}</td>
                                                <td>{{ form.unit }}</td>
                                                <td>{{ form.quantity }}</td>
                                                <td>{{ form.price }}</td>
                                                <td>{{ form.consumable_cost }}</td>
                                            </tr>
                                        </table>
                                    {% endfor %}
                                    <div id="empty_consum_form" style="display:none">
                                        <table class='no_error'>
                                            <tr>
                                                <td class="id_padding" class="index">replace_counter</td>
                                                <td>{{ consumable_formset.empty_form.consumable_id }}</td>
                                                <td>{{ consumable_formset.empty_form.name }}</td>
                                                <td>{{ consumable_formset.empty_form.unit }}</td>
                                                <td>{{ consumable_formset.empty_form.quantity }}</td>
                                                <td>{{ consumable_formset.empty_form.price }}</td>
                                                <td>{{ consumable_formset.empty_form.consumable_cost }}</td>
                                            </tr>
                                        </table>
                                    </div>

                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <ul class="responsive-table">
                                    <li class="table-row">
                                        <div class="col col-1" data-label="">Общая<span>стоимость</span></div>
                                        <div class="col col-2" data-label="Эксплуатационныйизнос"><span
                                                id="all_consumable_cost" class="divide-integer-label">{{ report.consumable_cost }}</span></div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 4 -->

                <!-- 5 -->
                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-title">Износ</span>
                        <img src="{% static '/makereport/img/Polygon.png' %}" alt="polygon" class="polygon">
                    </div>

                    <div class="inside-content accordion-content characteristic-table">
                        <div class="accordion-content-wrapper" style="align-items:center;">

                            <div class="details">
                                <div class="point">
                                    <span class="point-text">Балл</span>
                                    {{ wear_form.point }}
                                </div>
                                <div class="weight">
                                    <span class="weight-text">Т</span>
                                    {{ wear_form.weight }}
                                </div>
                                <div class="wear">
                                    <span class="prehnite-text">Износ</span>
                                    {#                                        <input type="text" class="input work-price-input wear-input">#}
                                    {{ wear_form.wear }}
                                </div>
                                <div class="prehnite">
                                    <span class="prehnite-text">Принит = </span>
                                    {{ wear_form.accept_wear }}
                                </div>
                            </div>
                            <table class="table">
                                <tbody>
                                <tr>
                                    <th class="characterstic-header">Оценка состояния</th>
                                    <th class="characterstic-header">Характеристика физического состояния</th>
                                    <th class="characterstic-header">Средний балл Б</th>
                                </tr>
                                <tr id="condition" class="tr-2">
                                    <td class="state">очень хорошее</td>
                                    <td class="physic-state">Оборудование , мало эксплуатировавшееся либо прошедшее
                                        качественный капитальный ремонт , в очень хорошем состоянии
                                    </td>
                                    <td class="average-score">50</td>
                                </tr>
                                <tr id="condition">
                                    <td class="state">хорошее</td>
                                    <td class="physic-state">Слабо поношенное , отремонтированное или обновленное
                                        оборудование в хорошем состоянии
                                    </td>
                                    <td class="average-score">40</td>
                                </tr>
                                <tr id="condition">
                                    <td class="state">среднее</td>
                                    <td class="physic-state">Оборудование в удовлетворительном состоянии, частично
                                        поношенное , требующее небольшого ремонта или замена отдельных мелких частей
                                        , таких , как подшибники , вкладыщи и д.р
                                    </td>
                                    <td class="average-score">30</td>
                                </tr>
                                <tr id="condition">
                                    <td class="state">посредственное</td>
                                    <td class="physic-state">Оборудование в работоспособном состоянии , но требующее
                                        ремонта или замены главных частей , таких , как двигатель и других
                                        отвественных узлов
                                    </td>
                                    <td class="average-score">20</td>
                                </tr>
                                <tr id="condition">
                                    <td class="state" style="border-bottom: 0;">плохое</td>
                                    <td class="physic-state" style="border-bottom: 0;">Оборудование в плохом
                                        состоянии , требующее такого капитального ремонта , как замена рабочих
                                        органов основных агрегатов
                                    </td>
                                    <td class="average-score" style="border-bottom: 0;">10</td>
                                </tr>
                                </tbody>
                            </table>

                            <table class="table">
                                <tbody>
                                <tr>
                                    <th class="characterstic-header">Физическая характеристика состояния
                                        транспортного средства
                                    </th>
                                    <th class="characterstic-header">Оценка сос-я</th>
                                    <th class="characterstic-header">Износ Итр,%</th>
                                </tr>
                                <tr id="condition" class="tr-2">
                                    <td class="physic-state">Новое, в отличном состоянии, после выполнения
                                        предпродажной подготовки.
                                    </td>
                                    <td class="state">Новое</td>
                                    <td class="average-score">0 -10</td>
                                </tr>
                                <tr id="condition">
                                    <td class="physic-state">Практически новое, периоде эксплуатации, с выполненными
                                        объемами технического обслуживания и не требующего ремонта или замены
                                        каких-либо частей.
                                    </td>
                                    <td class="state">Очень хорошее</td>
                                    <td class="average-score">10 - 20</td>
                                </tr>
                                <tr id="condition">
                                    <td class="physic-state">На послегарантийном периоде эксплуатации , с
                                        выполненными объемами технического обслуживания , не требующее текущего
                                        ремонта или замены каких-либо частей. После капитального ремонта.
                                    </td>
                                    <td class="state">Хорошее</td>
                                    <td class="average-score">20 - 40</td>
                                </tr>
                                <tr id="condition">
                                    <td class="physic-state">Бывшее в эксплуатации , с выполненными объемами
                                        технического обслуживания , требующее текущего ремонта или замены некоторых
                                        деталей , имеющее незначительное повреждение лакокрасочного покрытия
                                    </td>
                                    <td class="state">Удовлетворительное</td>
                                    <td class="average-score">40 - 60</td>
                                </tr>
                                <tr id="condition">
                                    <td class="physic-state">Бывшее в эксплуатации , в состоянии , пригодном для
                                        дальнейшей эксплуатации после выполнения работ текущего ремонта ( замены )
                                        агрегатов , ремонта ( наружной окраски ) кузова ( кабины ).
                                    </td>
                                    <td class="state">Условно пригодное</td>
                                    <td class="average-score">60 - 75</td>
                                </tr>
                                <tr id="condition">
                                    <td class="physic-state">Бывшее в эксплуатации , требующее капитального ремонта
                                        или замены номерных агрегатов ( двигателя , кузова , рамы ) , полной окраски
                                    </td>
                                    <td class="state">Неудовлетворительно-пригодно</td>
                                    <td class="average-score">до 80</td>
                                </tr>
                                <tr id="condition">
                                    <td class="physic-state" style="border-bottom: 0;">Бывшее в эксплуатации ,
                                        требующее ремонта в объеме , превышающем экономическую целесообразность его
                                        выполнения; отстутвие технической возможности осуществления такового;
                                        непригодное к эксплуатации и ремонту
                                    </td>
                                    <td class="state" style="border-bottom: 0;">Предварительное</td>
                                    <td class="average-score" style="border-bottom: 0;">80 и более</td>
                                </tr>
                                </tbody>
                            </table>


                        </div>
                    </div>
                </div>
                <!-- 5 -->
            </div>
            <div class="container my-4">
                <div class="file-loading">
                    {{ image_form.image }}
                </div>
            </div>
            <div class="container my-4">
                <div class="file-loading">
                    {{ passphoto_form.photo }}
                </div>
            </div>
            <div class="container my-4">
                <div class="file-loading">
                    {{ otherphoto_form.photos }}
                </div>
            </div>
            <div class="container my-4">
                <div class="file-loading">
                    {{ checks_form.checks }}
                </div>
            </div>

            {#                    <div class="file-upload2">#}
            {#                         <div class="file-loading2">#}
            {#                            <input id="kv-explorer" name="input" type="file" multiple>#}
            {#                              {{ passphoto_form.image }}#}
            {#                        </div>#}
            {#                    </div>#}
            {##}
            {#                    <div class="file-upload3">#}
            {#                         <div class="file-loading3">#}
            {#                            <input id="kv-explorer" name="input" type="file" multiple>#}
            {#                              {{ otherphoto_form.image }}#}
            {#                        </div>#}
            {#                    </div>#}


            <div class="almost_latest_block">
                <div class="row">

                    <div class="col-lg-1"></div>
                    <div class="col-lg-5">
                        <div class="welcome-part">

                            <div class="welcome_user">
                                <h2>Стоимость ущерба</h2>
                            </div>

                            <div class="panel_price">
                                <a href="#">
                                    {{ report_form.total_report_cost }}

                                    <button type="button" class="btn panel_price_button"><label id="all_sum">0</label>
                                        UZS
                                    </button>
                                </a>
                            </div>

                        </div>
                    </div>

                    <div class="col-lg-6 dont_know_why">
                        <div class="row">
                            <div class="col-lg-1"></div>
                            <div class="col-lg-8">

                                <div class="row last_details_price">
                                    <div class="col-sm-5 col-md-5 col-lg-5 col-xl-5 single_word">
                                        Опр ст.ущерба
                                    </div>
                                    <div class="col-sm-7 col-md-7 col-lg-7 col-xl-7 work_work"
                                         style="border: none;padding-left: 0;">
                                        {{ calculation_form.opr_damage }}
                                    </div>
                                </div>

                                <div class="row last_details_price">
                                    <div class="col-sm-5 col-md-5 col-lg-5 col-xl-5 single_word">
                                        Опр ст.УТС
                                    </div>
                                    <div class="col-sm-7 col-md-7 col-lg-7 col-xl-7 work_work"
                                         style="border: none;padding-left: 0;">
                                        {{ calculation_form.opr_ust }}
                                    </div>
                                </div>

                                <div class="row last_details_price">
                                    <div class="col-sm-5 col-md-5 col-lg-5 col-xl-5 single_word">
                                        Выезд
                                    </div>
                                    <div class="col-sm-7 col-md-7 col-lg-7 col-xl-7 work_work"
                                         style="border: none;padding-left: 0;">
                                        {{ calculation_form.departure }}
                                    </div>
                                </div>

                                <div class="row last_details_price">
                                    <div class="col-sm-5 col-md-5 col-lg-5 col-xl-5 single_word">
                                        Итого
                                    </div>
                                    <div class="col-sm-7 col-md-7 col-lg-7 col-xl-7 work_work"
                                         style="border: none;padding-left: 0;">
                                        {{ calculation_form.total }}
                                    </div>
                                </div>

                                <div class="row last_details_price">
                                    <div class="col-sm-12">
                                        <div class="save-btn-block">

                                            <button class="save-btn">Сохранить</button>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="material-form-2">
                <div class="last_bottom_block col-12">
                    <div class="row">

                        {#                        <div class="col-lg-4 white_blocks">#}
                        {#                            <div class="white_block">#}
                        {##}
                        {#                            </div>#}
                        {#                            <div class="little_white_block">#}
                        {#                                <span>№{{ report_number }}</span>#}
                        {#                            </div>#}
                        {#                        </div>#}

                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-lg-3 download_button">
                                    <div class="panel_user" id="download_button1">
                                        <a href="{% url 'get_mixing' id %}" target="_blank">
                                            <button type="button" class="btn panel_button">Посмотреть</button>
                                        </a>
                                    </div>
                                </div>

                                <div class="col-lg-2 download_button">
                                    <div class="panel_user" id="download_button2">
                                        <a href="{% url 'get_agreement' id %}" target="_blank">
                                            <button type="button" class="btn panel_button">Посмотреть</button>
                                        </a>
                                    </div>
                                </div>
                                {% if base %}
                                    <div class="col-lg-2 download_button">
                                        <div class="panel_user" id="download_button3">
                                            <a href="{% url 'get_response' id %}" target="_blank">
                                                <button type="button" class="btn panel_button">Посмотреть</button>
                                            </a>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="col-lg-2 download_button">
                                        <div class="panel_user" id="download_button4">
                                            <a href="{% url 'get_additional' id %}" target="_blank">
                                                <button type="button" class="btn panel_button">Посмотреть</button>
                                            </a>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if report.pdf_qr_code_company == None and id != 0 %}
                                    <div id="company_sign" class="col-lg-2 download_button">
                                        <div class="panel_user" id="download_button5">
                                            <button class="btn panel_button"
                                                    href="#" data-bs-toggle="modal"
                                                    data-bs-target="#exampleModal"
                                                    id="sign"
                                                    sign="{{ report.signed }}"
                                                    sign_from='0'
                                                    type="button"
                                                    data-bs-report="{{ report.report_id }}"
                                                    {#                                    pkcs7="{{ report.pdf_report_pkcs7.0 }}"#}
                                                    data-bs-whatever="{{ report.pdf_report_base64 }}"> Подписать
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if report.pdf_qr_code_user == None and id != 0 %}
                                    <div id="user_sign" class="col-lg-3 download_button">
                                        <div class="panel_user" id="download_button6">

                                            <button class="btn panel_button"
                                                    type="button"
                                                    id="sign_boss"
                                                    href="#" data-bs-toggle="modal"
                                                    data-bs-target="#exampleModal"
                                                    sign="{{ report.signed }}"
                                                    sign_from='1'
                                                    data-bs-report="{{ report.report_id }}"
                                                    {#                                    pkcs7="{{ report.pdf_report_pkcs7.0 }}"#}
                                                    data-bs-whatever="{{ report.pdf_report_base64 }}"> Подписать
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </form>

    </section>


    <svg class="liquid_shape_first" width="302" height="261" viewBox="0 0 302 261" fill="none"
         xmlns="http://www.w3.org/2000/svg">
        <path opacity="0.1"
              d="M270.752 -179.869C335.462 -170.06 413.703 -182.881 453.096 -130.674C492.522 -78.4224 459.489 -6.66316 450.329 58.1232C441.133 123.161 452.701 201.032 400.542 241.033C348.193 281.179 275.687 249.581 210.084 242.367C140.593 234.724 52.4779 256.191 13.1867 198.433C-25.9933 140.838 33.4778 68.6878 45.2454 0.0547791C56.3985 -64.9946 27.7037 -146.142 79.3285 -187.332C131.195 -228.714 205.12 -189.818 270.752 -179.869Z"
              fill="#5C6E91"/>
        <path opacity="0.1"
              d="M266.187 -152.282C322.397 -143.754 390.361 -154.901 424.579 -109.513C458.827 -64.0867 430.132 -1.70074 422.175 54.6232C414.188 111.165 424.236 178.865 378.929 213.641C333.456 248.543 270.474 221.073 213.488 214.801C153.125 208.157 76.5846 226.819 42.4545 176.606C8.42104 126.534 60.0803 63.8078 70.3021 4.13969C79.9902 -52.4129 55.0647 -122.961 99.9082 -158.77C144.962 -194.747 209.177 -160.932 266.187 -152.282Z"
              fill="#5C6E91"/>
    </svg>

    <svg class="liquid_shape_second" width="453" height="467" viewBox="0 0 453 467" fill="none"
         xmlns="http://www.w3.org/2000/svg">
        <path opacity="0.1"
              d="M251.752 26.131C316.462 35.9401 394.703 23.1187 434.096 75.3265C473.522 127.578 440.489 199.337 431.329 264.123C422.133 329.161 433.701 407.032 381.542 447.033C329.193 487.179 256.687 455.581 191.084 448.367C121.593 440.724 33.4779 462.191 -5.81331 404.433C-44.9933 346.838 14.4778 274.688 26.2454 206.055C37.3985 141.005 8.70372 59.8581 60.3285 18.6685C112.195 -22.7143 186.12 16.1822 251.752 26.131Z"
              fill="#5C6E91"/>
        <path opacity="0.1"
              d="M247.187 53.7177C303.397 62.2456 371.361 51.0989 405.579 96.4872C439.827 141.913 411.132 204.299 403.175 260.623C395.188 317.165 405.236 384.865 359.929 419.641C314.456 454.543 251.474 427.073 194.488 420.801C134.125 414.157 57.5846 432.819 23.4545 382.606C-10.579 332.534 41.0803 269.808 51.3021 210.14C60.9902 153.587 36.0647 83.0394 80.9082 47.23C125.962 11.2527 190.177 45.0684 247.187 53.7177Z"
              fill="#5C6E91"/>
    </svg>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Подписание документа</h5>
                    <button id="close_m" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <form name=testform>
                        <div class="container-fluid">
                            <div class="col-md-6">
                                <label id="message"></label>
                                Выберите ключ <br/>
                                <select class="form-select" id="floatingSelect"
                                        aria-label="Floating label select example" name="key"
                                        onchange="cbChanged(this)">
                                </select>
                            </div>
                            <div class="col-md-6">
                                <textarea class="file" name="data" style="display: none"></textarea>
                                {# style="display: none" #}
                            </div>

                            <label id="keyId" style="display: none"></label><br/>
                            <input id="sign" class="sign" class="sign" style="display: none"/>
                            <input id="sign_from" class="sign_from" style="display: none"/>
                            <input id="report_id" class="report_id" style="display: none"/>
                            {#                Подписанный документ PKCS#7<br />#}
                            <textarea class="pkcs7" name="pkcs7" style="display: none"></textarea><br/>
                            {# style="display: none" #}
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="close_model" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть
                    </button>
                    <button onclick="sign_decide(this)" type="button" class="btn btn-primary btn-link sign">Подписать
                    </button>
                    <br/>
                </div>
            </div>
        </div>
    </div>
</main><!-- End #main -->

{% csrf_token %}
{% block javascript %}
    <script src="{% static "makereport/js/imzo_sign.js" %}"></script>
    <script>
        var addServiceCounter = $('#service_formset').find('table').length - 1;
        var addProductCounter = $('#product_formset').find('table').length - 1;
        var addConsumableCounter = $('#consumable_formset').find('table').length - 1;


        function textAreaAdjust(element) {
            element.style.height = "1px";
            if (element.scrollHeight === 0) {
                element.style.height = "30px";
            } else
                element.style.height = (5 + element.scrollHeight) + "px";
        }

        function calculate_true_sum_product(previous) {
            const now = getDouble($('#product_overall_cost'));
            calculate_total_sum(now - previous)
        }

        function calculate_product_overall_sum(onReady = false) {
            var total = $('#all_product_cost');
            var int_total = getDouble(total);
            var procent = getDouble($('#product_wear_show'));
            var clean_total = int_total - int_total * procent / 100;
            var previous = getDouble($("#product_overall_cost"));
            $('#product_overall_cost').text(clean_total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, " "));
            if (!onReady) {
                calculate_true_sum_product(previous);
            }
        }

        function getDouble(element) {
            return element.text() === "" ? 0 : parseFloat(element.text().replace(/\s/g, ''));
        }

        var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
        $(document).on('keypress', "form", function (event) {
            return event.key !== "Enter";
        });


        $(".divide-integer").on('input', function (event) {
            var serialized = $(this).val().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " ");
            $(this).val(serialized);
        })

        $('.work-price-input2').on('change', function (event) {
            var price_1 = $('.price_1').val() ? parseInt($('.price_1').val().replace(/\s/g, '')) : 0;
            var price_2 = $('.price_2').val() ? parseInt($('.price_2').val().replace(/\s/g, '')) : 0;
            var price_3 = $('.price_3').val() ? parseInt($('.price_3').val().replace(/\s/g, '')) : 0;
            var all = price_1 + price_2 + price_3;
            $('.price_all').val(all.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " "));
        })

        function add_service() {
            var newTag = $('#empty_service_form').html();
            var updatedTag = newTag.replace(/__prefix__/g, addServiceCounter - 1);
            $('#service_formset').append(updatedTag.replace('replace_counter', addServiceCounter));
            $('#id_service-TOTAL_FORMS').val(addServiceCounter);
            addServiceCounter++;
        }

        function add_product() {
            var newTag = $('#empty_product_form').html();
            var updatedTag = newTag.replace(/__prefix__/g, addProductCounter - 1);
            $('#product_formset').append(updatedTag.replace('replace_counter', addProductCounter));
            $('#id_product-TOTAL_FORMS').val(addProductCounter);
            addProductCounter++;
        }

        function add_consumable() {
            var newTag = $('#empty_consum_form').html();
            var updatedTag = newTag.replace(/__prefix__/g, addConsumableCounter - 1);
            $('#consumable_formset').append(updatedTag.replace('replace_counter', addConsumableCounter));
            $('#id_consumable-TOTAL_FORMS').val(addConsumableCounter);
            addConsumableCounter++;
        }

        $(document).on('keydown', ".first2", function (e) {
            console.log('CLICK service_id')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var service_id = $(this).val(),
                    last_input_name = $(this).parents('tr').find('.name2'),
                    last_input_nph = $(this).parents('tr').find('.time2'),
                    last_input_price = $(this).parents('tr').find('.price2'),
                    last_input_premium = $(this).parents('tr').find('.allowance2'),
                    present_table = $(this).parents().next().find('.first2'),
                    service_cost = $(this).parents('tr').find('.sum2'),
                    brand = $('#id_brand').val();
                console.log(last_input_premium.val());
                {% comment %} if (brand == 0) {
                    alert("Пожалуйста, выберите марку!");
                }
                else  {% endcomment %}
                $.ajax({
                    url: '{% url "get_service_ajax" %}',
                    data: {
                        'service_id': service_id,
                        'brand': brand,
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log('success')
                        set_price(data.price, last_input_price);
                        last_input_name.val(data.name);
                        console.log(last_input_name);
                        textAreaAdjust(last_input_name[0]);
                        last_input_nph.val(data.norm_per_hour);

                        get_procent(last_input_premium);
                        last_input_premium.select()

                    },
                })
            }
        });

        function set_price(coming_price, set_class) {
            var price = $("#price_all_services").val()
            set_class.val(price === "0" ? coming_price : price);
        }

        function get_procent(item) {
            if (item.val() == "") {
                var procent = $("#procent").val().split(" ")[0];
                item.val(procent);
            }
        }

        $(document).on('keydown', ".price2", function (e) {
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var price = $(this).val(),
                    last_input_premium = $(this).parents('tr').find('.allowance2').val(),
                    nph = $(this).parents('tr').find('.time2').val(),
                    service_cost = $(this).parents('tr').find('.sum2'),
                    counter = $(this).parents('tr'),
                    parent = $(this).parents();
                $.ajax({
                    url: '{% url "get_service_cost" %}',
                    data: {
                        'premium': last_input_premium,
                        'price': price,
                        'nph': nph,
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log("sad")
                        var sum = data.service_cost - service_cost.val().replace(/\s/g, '');

                        if (addingTable(counter, addServiceCounter)) {
                            add_service();
                        }
                        const present_table = parent.next().find('.first2');
                        present_table.select()
                        calculate_total_sum(sum);
                        calculate_exact_sum(sum, 'service');
                        service_cost.val(data.service_cost.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " "))
                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                })
            }
        })

        function calculate_total_sum(sum) {
            var input = $(".all_sum");
            var label = $("#all_sum");
            var previous = input.val() === "" ? 0 : parseInt(input.val().replace(/\s/g, ''));
            console.log(sum + " VALUE PREVIOUS");
            var full_sum = sum + previous;
            input.val(full_sum);
            label.text(full_sum.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, " "));
        }

        function calculate_exact_sum(sum, tag) {
            var tag = `#all_${tag}_cost`;
            var label = $(tag);
            var previous = label.text() === "" ? 0 : parseInt(label.text().replace(/\s/g, ''));
            var full_sum = previous + sum;
            label.text(full_sum.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " "));
        }

        function addingTable(object, compare) {
            var counter = parseInt(object.find("td:first-child").text())
            console.log(`${counter}    ${compare}`)
            return counter === compare - 1;
        }

        $(document).on('keydown', ".allowance2", function (e) {
            console.log('CLICK premium')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var premium = $(this).val(),
                    price = $(this).parents('tr').find('.price2').val(),
                    nph = $(this).parents('tr').find('.time2').val(),
                    service_cost = $(this).parents('tr').find('.sum2'),
                    counter = $(this).parents('tr'),
                    parent = $(this).parents();

                $.ajax({
                    url: '{% url "get_service_cost" %}',
                    data: {
                        'premium': premium,
                        'price': price,
                        'nph': nph,
                    },
                    dataType: 'json',
                    success: function (data) {
                        {#last.select()#}
                        console.log(addingTable(counter, addServiceCounter))

                        if (addingTable(counter, addServiceCounter)) {
                            add_service();
                        }
                        const present_table = parent.next().find('.first2');
                        present_table.select()
                        var sum = data.service_cost - service_cost.val().replace(/\s/g, '');
                        calculate_total_sum(sum);
                        calculate_exact_sum(sum, 'service');
                        service_cost.val(data.service_cost.toString().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " "))
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("error")
                    }
                })
            }
        });

        $(document).on('keydown', ".count", function (e) {
            console.log('CLICK product_id')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var product_id = $(this).val(),
                    last_input_name = $(this).parents('tr').find('.name3'),
                    last_input_price = $(this).parents('tr').find('.price3'),
                    last_input_quantity = $(this).parents('tr').find('.time3')

                brand = $('#id_brand').val()

                $.ajax({
                    url: '{% url "get_product_ajax" %}',
                    data: {
                        'product_id': product_id,
                        'brand': brand,
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log('success')
                        console.log("data : " + data.name)
                        set_price(data.price, last_input_price);
                        last_input_quantity.select();
                        last_input_name.val(data.name);
                        textAreaAdjust(last_input_name[0]);
                        get_procent(last_input_quantity);

                    },
                })
            }
        });
        $(document).on('keydown', ".price4", function (e) {

            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var price = $(this).val(),
                    quantity = $(this).parents('tr').find('.allowance4').val(),
                    cost = $(this).parents('tr').find('.sum4'),
                    last = $(this).parents('tbody').find('tr').last(),
                    counter = $(this).parents('tr'),
                    parent = $(this).parents();
                {#last.clone().insertAfter(last);#}
                $.ajax({
                    url: '{% url "get_consumable_cost" %}',
                    data: {
                        'quantity': quantity,
                        'price': price,
                    },
                    dataType: 'json',
                    success: function (data) {
                        var sum = data.total_cost - cost.val().replace(/\s/g, '');
                        if (addingTable(counter, addConsumableCounter)) {
                            add_consumable();
                        }
                        const present_table = parent.next().find('.first4');
                        present_table.select()
                        calculate_total_sum(sum);
                        calculate_exact_sum(sum, 'consumable');
                        cost.val(data.total_cost.toString().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " "))
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("error")
                    }
                })
            }
        });
        $(document).on('keydown', ".allowance4", function (e) {
            console.log('CLICK quantity-cons')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var quantity = $(this).val(),
                    price = $(this).parents('tr').find('.price4').val(),
                    cost = $(this).parents('tr').find('.sum4'),
                    last = $(this).parents('tbody').find('tr').last(),
                    present_table = $(this).parents('.no_error').next().find('.first4'),
                    counter = $(this).parents('tr'),
                    parent = $(this).parents();
                {#last.clone().insertAfter(last);#}
                $.ajax({
                    url: '{% url "get_consumable_cost" %}',
                    data: {
                        'quantity': quantity,
                        'price': price,
                    },
                    dataType: 'json',
                    success: function (data) {

                        if (addingTable(counter, addConsumableCounter)) {
                            add_consumable();
                        }
                        const present_table = parent.next().find('.first4');
                        present_table.select()
                        var sum = data.total_cost - cost.val().replace(/\s/g, '');
                        calculate_total_sum(sum);
                        calculate_exact_sum(sum, 'consumable');
                        cost.val(data.total_cost.toString().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " "))
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("error")
                    }
                })
            }
        });

        $(document).on('keydown', ".first4", function (e) {
            console.log('CLICK consumable_id')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var consumable_id = $(this).val(),
                    last_input_name = $(this).parents('tr').find('.name4'),
                    last_input_unit = $(this).parents('tr').find('.time4'),
                    last_input_price = $(this).parents('tr').find('.price4'),
                    last_input_price_cons = $(this).parents('tr').find('.allowance4'),
                    cost = $(this).parents('tr').find('.sum4')
                $.ajax({
                    url: '{% url "get_consumable_ajax" %}',
                    data: {
                        'consumable_id': consumable_id,
                    },
                    dataType: 'json',
                    success: function (data) {

                        get_procent(last_input_price_cons)
                        last_input_price.val(data.price);
                        {#set_price(data.price, last_input_price);#}
                        last_input_price_cons.select()
                        last_input_name.val(data.name)
                        textAreaAdjust(last_input_name[0]);
                        last_input_unit.val(data.unit)


                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("error")
                    }
                })
            }
        });
        $(document).on('keydown', ".price3", function (e) {
            console.log('CLICK quantity one')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var price = $(this).val(),
                    quantity = $(this).parents('tr').find('.time3').val(),
                    cost = $(this).parents('tr').find('.sum3'),
                    counter = $(this).parents('tr'),
                    parent = $(this).parents();
                $.ajax({
                    url: '{% url "get_product_cost" %}',
                    data: {
                        'quantity': quantity,
                        'price': price,
                    },
                    dataType: 'json',
                    success: function (data) {

                        if (addingTable(counter, addProductCounter)) {
                            add_product();
                        }
                        var sum = data.total_cost - cost.val().replace(/\s/g, '');
                        const present_table = parent.next().find('.name3');
                        present_table.select();
                        calculate_exact_sum(sum, 'product')
                        calculate_product_overall_sum();
                        cost.val(data.total_cost.toString().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " "));
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("error")
                    }
                })
            }
        });

        $(document).on('keydown', ".time3", function (e) {
            console.log('CLICK quantity two')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var quantity = $(this).val(),
                    price = $(this).parents('tr').find('.price3').val(),
                    cost = $(this).parents('tr').find('.sum3'),
                    last = $(this).parents('tbody').find('tr').last(),
                    counter = $(this).parents('tr'),
                    parent = $(this).parents();
                console.log("item 3" + quantity)
                {#last.clone().insertAfter(last);#}
                $.ajax({
                    url: '{% url "get_product_cost" %}',
                    data: {
                        'quantity': quantity,
                        'price': price,
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (addingTable(counter, addProductCounter)) {
                            add_product();
                        }
                        const present_table = parent.next().find('.name3');
                        present_table.select();
                        console.log(typeof(cost.val()));
                        var sum = data.total_cost - cost.val().replace(/\s/g, '');
                        console.log(sum);
                        calculate_exact_sum(sum, 'product');
                        calculate_product_overall_sum();
                        cost.val(data.total_cost.toString().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " "));
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("error")
                    }
                })
            }
        });
        $(document).on('keydown', ".weight-input", function (e) {
            console.log('CLICK point-input')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var weight = $(this).val(),
                    point = $(this).parents('.details').find('.point-input').val(),
                    wear = $(this).parents('.details').find('.prehnite-input');
                console.log(`THE POINT ${point}  weight  ${weight}`);
                $.ajax({
                    url: '{% url "get_wear_ajax" %}',
                    data: {
                        'point': point,
                        'weight': weight,
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log('success calculate cost');
                        wear.select();
                        $('#product_wear_show').text(data.wear);
                        calculate_product_overall_sum();
                        wear.val(data.wear);
                    },
                })
            }
        });
        $(".prehnite-input").on('keydown', function (e) {
            var weight = $(this).val();
            console.log(weight);
            $('#product_wear_show').text(weight);
            calculate_product_overall_sum();
        })
        $(document).on('keydown', ".point-input", function (e) {
            console.log('CLICK point-input')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var point = $(this).val(),
                    weight = $(this).parents('.details').find('.weight-input')
                weight.select()
            }
        });


        $(document).on('keydown', ".prehnite-input", function (e) {
            console.log('CLICK accept_weight')
            var key = e.which;
            if (key === 13) {
                e.preventDefault();
                var point = $(this).val(),
                    btn = $(document).find('#imageinput')
                btn.focus()
            }
        });

        $(".btn-warning").on('click', function () {
            var $el = $("#file-4");
            if ($el.attr('disabled')) {
                $el.fileinput('enable');
            } else {
                $el.fileinput('disable');
            }
        });

        $(".btn-info").on('click', function () {
            $("#file-4").fileinput('refresh', {previewClass: 'bg-info'});
        });


        function integer_divide(obj) {
            console.log(obj)

        }

        $(document).ready(function () {
            calculate_total_sum(0);
            calculate_product_overall_sum(true);
            $(".divide-integer").each(function () {
                var serialized = $(this).val().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                $(this).val(serialized);
                $(this).text(serialized);
            })
            $(".divide-integer-label").each(function (){
                var serialized = $(this).text().replace(/\s/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                $(this).text(serialized);
            })
            const server = "https://e-otsenka.uz";
            $("#test-upload").fileinput({
                'theme': 'fas',
                'showPreview': false,
                'allowedFileExtensions': ['jpg', 'png', 'gif'],
                'elErrorContainer': '#errorBlock'
            });
            $("#imageinput").fileinput({
                'theme': 'fas',
                'uploadUrl': '{% url 'image_view' %}',
                'overwriteInitial': false,
                'uploadAsync': true,
                'initialPreviewAsData': true,
                'initialPreview': [
                    {% for each in images %}
                        `${server}{{ each.image.url }}`,
                    {% endfor %}
                ],
                'initialPreviewConfig': [

                    {% for each in images %}
                        {
                            url: '{% url 'image_delete' %}',
                            key: {{ each.image_id }},
                        },
                    {% endfor %}
                ],
                'ajaxSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                },
                'uploadExtraData': {
                    id: {{ id_image }},
                },
                'initialCaption': 'Выберите фото машины',
                'showUpload': true,
                'required': true,
                'ajaxDeleteSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                }
            });

            $("#pphotoinput").fileinput({
                'theme': 'fas',
                'initialCaption': 'Выберите фото паспорта',
                'uploadUrl': '{% url 'pphoto_view' %}',
                'overwriteInitial': false,
                'uploadAsync': true,
                'initialPreviewAsData': true,
                'initialPreview': [
                    {% for each in pphotos %}
                        `${server}{{ each.photo.url }}`,
                    {% endfor %}
                ],
                'initialPreviewConfig': [

                    {% for each in pphotos %}
                        {
                            url: '{% url 'pphoto_delete' %}',
                            key: {{ each.p_photo_id }},
                        },
                    {% endfor %}
                ],
                'ajaxSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                },
                'uploadExtraData': {
                    id: {{ id_image }},
                },
                'showUpload': true,
                'required': true,
                'ajaxDeleteSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                }

            });
            $("#ophotoinput").fileinput({
                'theme': 'fas',
                'initialCaption': 'Выберите тех фото паспорта',
                'uploadUrl': '{% url 'ophoto_view' %}',
                'overwriteInitial': false,
                'uploadAsync': true,
                'initialPreviewAsData': true,
                'initialPreview': [
                    {% for each in ophotos %}
                        `${server}{{ each.photos.url }}`,
                    {% endfor %}
                ],
                'initialPreviewConfig': [

                    {% for each in ophotos %}
                        {
                            url: '{% url 'ophoto_delete' %}',
                            key: {{ each.o_photo_id }},
                        },
                    {% endfor %}
                ],
                'ajaxSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                },
                'uploadExtraData': {
                    id: {{ id_image }},
                },
                'showUpload': true,
                'required': true,
                'ajaxDeleteSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                }
            });
            $("#checksinput").fileinput({
                'theme': 'fas',
                initialCaption: 'Выберите фото чеков',
                'uploadUrl': '{% url 'checks_view' %}',
                'overwriteInitial': false,
                'uploadAsync': true,
                'initialPreviewAsData': true,
                'initialPreview': [
                    {% for each in checks %}
                        `${server}{{ each.checks.url }}`,
                    {% endfor %}
                ],
                'initialPreviewConfig': [

                    {% for each in checks %}
                        {
                            url: '{% url 'chekcs_delete' %}',
                            key: {{ each.checks_id }},
                        },
                    {% endfor %}
                ],
                'ajaxSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                },
                'uploadExtraData': {
                    id: {{ id_image }},
                },
                'showUpload': true,
                'required': true,
                'ajaxDeleteSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                }

            });
        });
    </script>

{% endblock %}

<script src="{% static '/makereport/js/desktop3.js' %}"></script>

</body>


</html>